name: Calculate Time Difference

on:
  push:
    branches:
      - main

jobs:
  calculate-time-difference:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Get first commit timestamp
        id: get_first_commit
        run: |
          FIRST_COMMIT=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            "https://api.github.com/repos/${{ github.repository }}/commits?sha=main&per_page=1" | jq -r "..commit.committer.date")
          echo "FIRST_COMMIT_DATE=$FIRST_COMMIT" >> $GITHUB_ENV

      - name: Calculate time difference
        run: |
          CURRENT_DATE=$(date -u +"%Y-%m-%dT%H:%M:%SZ")
          FIRST_COMMIT_DATE=${{ env.FIRST_COMMIT_DATE }}
          TIME_DIFF=$(($(date -d "$CURRENT_DATE" +%s) - $(date -d "$FIRST_COMMIT_DATE" +%s)))
          TIME_DIFF_HOURS=$(($TIME_DIFF / 3600))
          echo "Time difference in hours: $TIME_DIFF_HOURS"
